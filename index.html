<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> 
    circle { fill: red; stroke: black; }
</style>
<body onload='init()'>
<svg width=300 height=300>
</svg>
<script>
async function init() {
    // Load and parse the CSV data
    const data = await d3.csv('https://flunky.github.io/cars2017.csv', d => {
        return {
            AverageCityMPG: +d.AverageCityMPG,
            AverageHighwayMPG: +d.AverageHighwayMPG,
            EngineCylinders: +d.EngineCylinders
        };
    });


    // Set margins and dimensions
    const margin = {top: 50, right: 50, bottom: 50, left: 50};
    const width = 200;
    const height = 200;

    // Create scales
    const x = d3.scaleLog()
                .domain([10, 150])
                .range([0, width])
                .base(10);

    const y = d3.scaleLog()
                .domain([10, 150])
                .range([height, 0])
                .base(10);

    // Create SVG canvas
    const svg = d3.select('svg')
                  .attr('width', width + margin.left + margin.right)
                  .attr('height', height + margin.top + margin.bottom)
                  .append('g')
                  .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

    // Add circles
    svg.selectAll('circle')
       .data(data)
       .enter()
       .append('circle')
       .attr('cx', d => x(d.AverageCityMPG))
       .attr('cy', d => y(d.AverageHighwayMPG))
       .attr('r', d => 2 + d.EngineCylinders);

    // Add x-axis
    const xAxis = d3.axisBottom(x)
                    .tickValues([10, 20, 50, 100])
                    .tickFormat(d3.format("~s"));

    svg.append('g')
       .attr('transform', 'translate(0,' + height + ')')
       .call(xAxis);

    // Add y-axis
    const yAxis = d3.axisLeft(y)
                    .tickValues([10, 20, 50, 100])
                    .tickFormat(d3.format("~s"));

    svg.append('g')
       .call(yAxis);
}
</script>
</body>
</html>
